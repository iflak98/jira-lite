<app-header></app-header>

<div class="board-container" *ngIf="selectedBoard()">
  <div class="board-header">
    <button class="back-btn" (click)="goBack()">← Back to Boards</button>
    <h2>{{ selectedBoard()?.title }}</h2>
  </div>

  <div class="lists" cdkDropListGroup>
    <div
      class="list"
      *ngFor="let list of lists(); trackBy: trackByList"
      cdkDropList
      [cdkDropListData]="list.cards"
      (cdkDropListDropped)="drop($event, list)"
    >
      <h3>{{ list.title }}</h3>

      <!-- ✅ Cards container -->
      <div class="cards">
        <!-- ✅ Draggable cards (not viewer) -->
        <ng-container *ngFor="let card of list.cards; trackBy: trackByCard">
          <div
            class="card"
            cdkDrag
            [cdkDragData]="card"
            [ngClass]="{
              'high-priority': card.priority === 'HIGH',
              'medium-priority': card.priority === 'MEDIUM',
              'low-priority': card.priority === 'LOW'
            }"
            *ngIf="!isViewer() && canSeeCard(card)"
          >
            <strong>{{ card.title }}</strong>
            <small>{{ card.priority }}</small>
            <p>{{ card.createdAt }}</p>
          </div>

          <!-- ✅ Non-draggable cards (viewer only) -->
          <div
            class="card disabled"
            [ngClass]="{
              'high-priority': card.priority === 'HIGH',
              'medium-priority': card.priority === 'MEDIUM',
              'low-priority': card.priority === 'LOW'
            }"
            *ngIf="isViewer() && canSeeCard(card)"
          >
            <strong>{{ card.title }}</strong>
            <small>{{ card.priority }}</small>
            <p>{{ card.createdAt }}</p>
          </div>
        </ng-container>
      </div>
    </div>
  </div>
</div>

<div *ngIf="!selectedBoard()">
  <p>No board selected.</p>
</div>
