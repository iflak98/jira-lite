<app-header></app-header>

<div class="admin-container">
  <h2>User Management</h2>

  <div *ngFor="let user of users()" class="user-card">
    <h3>{{ user.name }} ({{ user.roles }})</h3>

    <div class="tasks">

      
      <div class="todo">
        <h4>To Do</h4>
        <ul>
          <li
            *ngFor="let task of getUserTasks(user.id, 'todo')"
            class="task-card"
            [ngClass]="{
              'high-priority': task.priority === 'HIGH',
              'medium-priority': task.priority === 'MEDIUM',
              'low-priority': task.priority === 'LOW'
            }"
          >
            <h3>{{ task.title }}</h3>
            <strong>{{ task.priority }}</strong>
            <br />
            {{ task.description }}
            <br />

            <label>
              Priority:
              <select
                [(ngModel)]="task.priority"
                (ngModelChange)="updateTaskPriority(task.id, $event)"
              >
                <option *ngFor="let p of priorities()" [ngValue]="p">
                  {{ p }}
                </option>
              </select>
            </label>

            <button (click)="markInProgress(user.id, task.id)">
              Move to In Progress
            </button>
          </li>
        </ul>
      </div>

      <div class="in-progress">
        <h4>In Progress</h4>
        <ul>
          <li
            *ngFor="let task of getUserTasks(user.id, 'in-progress')"
            class="task-card"
            [ngClass]="{
              'high-priority': task.priority === 'HIGH',
              'medium-priority': task.priority === 'MEDIUM',
              'low-priority': task.priority === 'LOW'
            }"
          >
            <h3>{{ task.title }}</h3>
            <strong>{{ task.priority }}</strong>
            <br />
            {{ task.description }}
            <br />

            <label>
              Priority:
              <select
                [(ngModel)]="task.priority"
                (ngModelChange)="updateTaskPriority(task.id, $event)"
              >
                <option *ngFor="let p of priorities()" [ngValue]="p">
                  {{ p }}
                </option>
              </select>
            </label>

            <button (click)="markAsDone(user.id, task.id)">
              Mark as Done
            </button>
          </li>
        </ul>
      </div>


      <div class="done">
        <h4>Done</h4>
        <ul>
          <li
            *ngFor="let task of getUserTasks(user.id, 'done')"
            class="task-card"
            [ngClass]="{
              'high-priority': task.priority === 'HIGH',
              'medium-priority': task.priority === 'MEDIUM',
              'low-priority': task.priority === 'LOW'
            }"
          >
            <h3>{{ task.title }}</h3>
            <strong>{{ task.priority }}</strong>
            <br />
            {{ task.description }}
            <br />

            <button (click)="markInProgressfromDone(user.id, task.id)">
              Move to In Progress
            </button>
          </li>
        </ul>
      </div>

    </div>
  </div>
</div>
